import{I as G,R as K,J as Q,f as D,_ as V,o as Z,c as ee,q as te,r as ne}from"./app.8b62e66d.js";const W={async getCompletedImage(e){return e.complete?e:new Promise((s,d)=>{e.onload&&d("This image has been onload"),e.onload=()=>{s(this.getCompletedImage(e))}})},async getAvailableImageOptions(e){const s=await this.getCompletedImage(e.image),{naturalWidth:d,naturalHeight:g}=s,w=Math.min(e.sx||0,d),v=Math.min(e.sWidth||d,d-w),r=Math.min(e.sy||0,g),c=Math.min(e.sHeight||g,g-r),B=e.dx||0,l=e.dy||0,p=e.dWidth||v,x=e.dHeight||c;return{image:s,sx:w,sy:r,sWidth:v,sHeight:c,dx:B,dy:l,dWidth:p,dHeight:x}},updateShapesBoundingRect(e,s){return e?{x1:Math.min(e.x1,s.x1),x2:Math.max(e.x2,s.x2),y1:Math.min(e.y1,s.y1),y2:Math.max(e.y2,s.y2)}:s}};function se(e,{emit:s}){const{width:d,height:g,options:w,shapes:v}=e,r=G();let c,B=w.scale||1,l=w.scale||1,p=w.translateX||0,x=w.translateY||0,X=!1,b={x:0,y:0},R=.2,j=16,k=null;K(async()=>{c=r.value.getContext("2d");const o=await q();if(w.fit&&o){const{x1:i,x2:a,y1:n,y2:h}=k=o,u=d/(a-i),f=g/(h-n);switch(w.fit){case"contain":l=B=R=Math.min(u,f);break;case"cover":l=B=R=Math.max(u,f);break}p=d/2-(a+i)/2*l,x=g/2-(h+n)/2*l}C()}),Q(()=>e.shapes,()=>{C()},{deep:!0});const O=()=>{c.translate(p,x),c.scale(l,l)},C=async()=>{c.clearRect(0,0,d,g),c.save(),O();for(let t=0;t<v.length;t++){const{type:o,fixed:i,options:a,...n}=v[t];if(i&&c.restore(),c.save(),a){const{fillStyle:h,font:u,textAlign:f,textBaseline:m}=a;h&&(c.fillStyle=h),u&&(c.font=u),f&&(c.textAlign=f),m&&(c.textBaseline=m)}switch(o){case"rect":E(n);break;case"text":N(n);break;case"image":await P(n);break;default:console.error("Unrecognized shape type")}c.restore(),i&&(c.save(),O())}c.restore()},E=t=>{const{x:o,y:i,width:a,height:n}=t;c.fillRect(o,i,a,n)},N=t=>{const{text:o,x:i,y:a,maxWidth:n}=t;c.fillText(o,i,a,n)},P=async t=>{const{image:o,sx:i,sy:a,sWidth:n,sHeight:h,dx:u,dy:f,dWidth:m,dHeight:M}=await W.getAvailableImageOptions(t);c.drawImage(o,i,a,n,h,u,f,m,M)},q=async()=>{let t=null;for(let o=0;o<v.length;o++){const{type:i,fixed:a,...n}=v[o];if(!a)switch(i){case"rect":t=W.updateShapesBoundingRect(t,{x1:n.x,x2:n.x+n.width,y1:n.y,y2:n.y+n.height});break;case"text":const h=F(n);t=W.updateShapesBoundingRect(t,h);break;case"image":const{dx:u,dy:f,dWidth:m,dHeight:M}=await W.getAvailableImageOptions(n);t=W.updateShapesBoundingRect(t,{x1:u,y1:f,x2:u+m,y2:f+M});break;default:console.error("Unrecognized shape type")}}return t},F=t=>{const{text:o,x:i,y:a,maxWidth:n}=t,{width:h,actualBoundingBoxLeft:u,actualBoundingBoxRight:f,fontBoundingBoxAscent:m,fontBoundingBoxDescent:M}=c.measureText(o),H=h>n?h-n:0;return{x1:i-u,x2:i+f-H,y1:a-m,y2:a+M}},J=(t,o,i=0)=>{l=i>0?Math.min(B+i,j):Math.max(B+i,R);const a=t-(t-p)/B*l,n=o-(o-x)/B*l;if(k){const{x1:h,x2:u,y1:f,y2:m}=k,M=Math.min(a,-h*l),H=Math.max(a,d-u*l),U=Math.min(n,-f*l),S=Math.max(n,g-m*l);a!==M?p=M:a!==H?p=H:p=a,n!==U?x=U:n!==S?x=S:x=n}else p=a,x=n;C(),B=l},L=(t,o)=>{const i=t-b.x,a=o-b.y;b={x:t,y:o};const n=p+i,h=x+a;if(k){const{x1:u,x2:f,y1:m,y2:M}=k;p=i>0?Math.min(n,-u*l):Math.max(n,d-f*l),x=a>0?Math.min(h,-m*l):Math.max(h,g-M*l)}else p=n,x=h;C()},_=([t,o])=>[(t-p)/l,(o-x)/l];return{canvasRef:r,handleMouseWheel:t=>{t.preventDefault();let o=t.deltaY>0?-.1:.1;J(t.offsetX,t.offsetY,o)},handleMouseDown:t=>{X=!0,b={x:t.offsetX,y:t.offsetY}},handleMouseUpOrOut:t=>{X=!1,b={x:t.offsetX,y:t.offsetY}},handleMouseMove:t=>{X&&L(t.offsetX,t.offsetY)},handleClick:t=>{const o=_([t.offsetX,t.offsetY]);s("click",o,t)}}}const oe=D({name:"BaseCanvas",emits:["click"],props:{width:{type:Number,default:300},height:{type:Number,default:300},options:{type:Object,default(){return{}}},shapes:{type:Array,default(){return[]}}},setup(e,{emit:s}){return{...se(e,{emit:s})}}}),ae=["width","height"];function ie(e,s,d,g,w,v){return Z(),ee("canvas",{ref:"canvasRef",width:e.width,height:e.height,onMousewheel:s[0]||(s[0]=(...r)=>e.handleMouseWheel&&e.handleMouseWheel(...r)),onMousedown:s[1]||(s[1]=(...r)=>e.handleMouseDown&&e.handleMouseDown(...r)),onMouseup:s[2]||(s[2]=(...r)=>e.handleMouseUpOrOut&&e.handleMouseUpOrOut(...r)),onMouseout:s[3]||(s[3]=(...r)=>e.handleMouseUpOrOut&&e.handleMouseUpOrOut(...r)),onMousemove:s[4]||(s[4]=(...r)=>e.handleMouseMove&&e.handleMouseMove(...r)),onClick:s[5]||(s[5]=(...r)=>e.handleClick&&e.handleClick(...r))},null,40,ae)}var le=V(oe,[["render",ie],["__file","BaseCanvas.vue"]]),ce="/assets/the_yellow_house.0fc7fd32.webp";const z=new Image;z.src=ce;const y=document.body.offsetWidth,Y=document.body.offsetHeight,re=y>540?98:y>390?72:58,he=y/2,de=Y/8,ue=y-20,A=y>540?400:y>390?300:y>320?240:y-80,I=y>540?150:120,$=(y-A)/2,T=Y/3*2-I/2,fe=A-20,pe=y/2,xe=Y/3*2,me=D({name:"HomeView",components:{BaseCanvas:le},data(){return{width:y,height:Y,options:{fit:"cover"},shapes:[{type:"image",image:z},{type:"text",fixed:!0,text:"\u6587\u71DA\u7684\u535A\u5BA2",x:he,y:de,maxWidth:ue,options:{fillStyle:"rgba(0, 0, 0, .9)",font:`bold ${re}px serif`,textAlign:"center",textBaseline:"top"}},{type:"rect",fixed:!0,x:$,y:T,width:A,height:I,options:{fillStyle:"rgba(255, 255, 255, .5)"}},{type:"text",fixed:!0,text:"\u5B66\u4E60\u7B14\u8BB0",x:pe,y:xe,maxWidth:fe,options:{fillStyle:"rgba(0, 0, 0, .9)",font:"bold 42px serif",textAlign:"center",textBaseline:"middle"}}]}},methods:{click(e,{offsetX:s,offsetY:d}){s>$&&s<$+A&&d>T&&T<T+I&&(window.location.href="/javascript/")}}});function ye(e,s,d,g,w,v){const r=ne("BaseCanvas");return Z(),te(r,{width:e.width,height:e.height,shapes:e.shapes,options:e.options,onClick:e.click},null,8,["width","height","shapes","options","onClick"])}var ke=V(me,[["render",ye],["__file","HomeView.vue"]]);export{ke as default};
